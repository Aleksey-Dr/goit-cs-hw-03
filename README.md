<a id="top"></a>

# Вступ до вивчення систем управління базами даних

---

**Зміст**

<a href="#1"><img src="https://img.shields.io/badge/Tasck 1. Task manager-512BD4?style=for-the-badge"/></a> <a href="#2"><img src="https://img.shields.io/badge/Tasck 2. Mongodb App-ECD53F?style=for-the-badge"/></a>

---

<a id="1"></a>

## Tasck 1

### Task manager

1. **Cтворення віртуального оточення**

Це ізолює залежності проєкту від глобального середовища Python.

**Кроки для створення віртуального оточення**

1) Відкрийте термінал або командний рядок. Перейдіть до кореневої папки проєкту ```task_manager```.
2) Створіть віртуальне оточення. Використайте модуль ```venv```, <u>який вбудований у Python 3</u>. Назвемо оточення ```venv``` (це поширена практика):

```bash
python -m venv venv
```

Ця команда створить папку ```venv``` у вашій директорії, яка міститиме копію інтерпретатора **Python** та інші необхідні файли.

3) Активуйте віртуальне оточення. Після створення, потрібно його активувати. Команда залежить від операційної системи:

- На **Windows**:

```bash
venv\Scripts\activate
```

- На **macOS** та **Linux**:

```bash
source venv/bin/activate
```

Після активації, перед командним рядком з'явиться назва вашого віртуального оточення ```(venv)```, що вказує на те, що ви працюєте в ізольованому середовищі.

Встановіть залежності. Тепер, коли оточення активне, ви можете встановити необхідні бібліотеки (psycopg2-binary, Faker), які використовуються у файлі seed.py.

4) Встановіть залежності.
Щоб встановити пакети, використовуйте:

```bash
pip install -r requirements.txt
```

5) Для деактивації віртуального оточення, просто виконайте команду:

```bash
deactivate
```

2. **Встановлення PostgreSQL**

- Переконайтеся, що у вас встановлено PostgreSQL.

```bash
psql --version
```

Если PostgreSQL установлен, эта команда вернёт его версию, например: ```psql (PostgreSQL) 17.5```.
Если вы получите сообщение об ошибке, вроде ```command not found``` (команда не найдена), это значит, что **PostgreSQL** не установлен или его исполняемый файл не находится в системном пути.

3. **Створення бази даних**

- Підключіться до вашого сервера PostgreSQL (наприклад, через ```psql```):

Відкрийте клієнт ```psql```. У командному рядку або терміналі введіть:

```bash
psql -U your_user
```

⚠️ Замініть your_user на ваше ім'я користувача PostgreSQL (зазвичай це ```postgres```). Вам буде запропоновано ввести пароль.

Виконайте **SQL**-команду. Після успішного підключення, ви потрапите в командний рядок ```psql``` (він буде виглядати приблизно так: ```postgres=#```). Тепер ви можете виконати команду ```CREATE DATABASE```:

```sql
CREATE DATABASE task_manager_db;
```

Перевірте успішність. Після виконання команди ви побачите повідомлення ```CREATE DATABASE```. Тепер ви можете підключитися до новоствореної бази даних, щоб працювати з нею.

```sql
\c task_manager_db
```

Після успішного підключення до бази даних (```task_manager```) командний рядок ```psql``` буде виглядати так: ```task_manager_db=#```.
(Команда ```\c``` використовується для підключення до іншої бази даних всередині ```psql```).

⚠️ Щоб вийти з командного рядка **PostgreSQL** (```psql```), необхідно використовувати мета-команду ```\q``` (від слова "quit"). Просто введіть її та натисніть Enter.

4. **Виконання SQL-скрипту**

- Виконайте скрипт ```create_tables.sql```, щоб створити таблиці у базі даних.
- Використайте команду ```psql```:

```bash
psql -U your_user -d task_manager_db -f create_tables.sql
```
(Замініть your_user на ваше ім'я користувача PostgreSQL).

Після виконання команди ви побачите повідомлення:

```
CREATE TABLE
CREATE TABLE
CREATE TABLE
INSERT 0 3
```

5. **Запуск скрипту ```seed.py```**

Запустіть скрипт для заповнення бази даних:

```bash
python seed.py
```

6. **Виконання SQL-запитів**

Тепер ви можете підключитися до бази даних ```task_manager_db``` (наприклад, через ```psql``` або **DBeaver**) і виконувати надані **SQL**-запити для перевірки та роботи з даними.

- Підключення до бази даних
    - Відкрийте термінал (командний рядок) на вашому комп'ютері
    - Увійдіть у psql з вашим користувачем і підключіться до бази даних:
    ```bash
    psql -U your_user -d task_manager_db
    ```
    Замініть ```your_user``` на ваше ім'я користувача **PostgreSQL**. Система попросить ввести пароль.
- ***Виконання запитів***
Тепер ви можете копіювати та вставляти надані **SQL**-запити по одному, натискаючи Enter після кожного, щоб виконати їх.
    - (**1**) Отримати всі завдання певного користувача (наприклад, з ```id = 1```):
    ```sql
    SELECT * FROM tasks WHERE user_id = 1;
    ```
    - (**2**) Вибрати завдання за статусом ('new'):
    ```sql
    SELECT * FROM tasks WHERE status_id = (SELECT id FROM status WHERE name = 'new');
    ```
    - (**3**) Оновити статус конкретного завдання (наприклад, з ```id = 10```). Змінює ```status_id``` завдання з ```id = 10``` на ```id``` статусу ```in progress```:
    ```sql
    UPDATE tasks SET status_id = (SELECT id FROM status WHERE name = 'in progress') WHERE id = 10;
    ```
    Система поверне повідомлення, наприклад, ```UPDATE 1```, що означає, що один рядок було оновлено.
    - (**4**) Отримати список користувачів без завдань. Використовується ```WHERE NOT IN``` з підзапитом для вибору ```user_id``` з таблиці ```tasks```, щоб знайти користувачів, яких там немає:
    ```sql
    SELECT * FROM users WHERE id NOT IN (SELECT user_id FROM tasks);
    ```
    - (**5**) Додати нове завдання для конкретного користувача. Запит ```INSERT``` додає новий запис у таблицю ```tasks```. Статус і користувач визначаються через підзапити:
    ```sql
    INSERT INTO tasks (title, description, status_id, user_id) VALUES ('Нове завдання', 'Опис нового завдання', (SELECT id FROM status WHERE name = 'new'), 5);
    ```
    - (**6**) Отримати всі завдання, які ще не завершено. Вибирає завдання, чий статус ```id``` не дорівнює ```id``` статусу ```completed```:
    ```sql
    SELECT * FROM tasks WHERE status_id != (SELECT id FROM status WHERE name = 'completed');
    ```
    - (**7**) Видалити конкретне завдання. Запит ```DELETE``` видаляє рядок з таблиці ```tasks``` за вказаним ```id```:
    ```sql
    DELETE FROM tasks WHERE id = 5;
    ```
    - (**8**) Знайти користувачів з певною електронною поштою. Використовує оператор LIKE для пошуку електронних адрес, що містять певний домен:
    ```sql
    SELECT * FROM users WHERE email LIKE '%@example.com';
    ```
    - (**9**) Оновити ім'я користувача. Змінює ```fullname``` користувача з ```id = 2```:
    ```sql
    UPDATE users SET fullname = 'Нове Ім''я' WHERE id = 2;
    ```
    - (**10**) Отримати кількість завдань для кожного статусу:
    ```sql
    SELECT s.name, COUNT(t.id)
    FROM tasks AS t
    JOIN status AS s ON t.status_id = s.id
    GROUP BY s.name;
    ```
    - (**11**) Отримати завдання, які призначені користувачам з певною доменною частиною електронної пошти. Використовує ```JOIN``` для об'єднання ```tasks``` і ```users```, а потім ```LIKE``` для фільтрації за електронною поштою користувача:
    ```sql
    SELECT t.*
    FROM tasks AS t
    JOIN users AS u ON t.user_id = u.id
    WHERE u.email LIKE '%@gmail.com';
    ```
    - (**12**) Отримати список завдань, що не мають опису. Використовує умову IS NULL для пошуку завдань, у яких поле description не містить жодного значення:
    ```sql
    SELECT * FROM tasks WHERE description IS NULL;
    ```
    - (**13**) Вибрати користувачів та їхні завдання, які є у статусі ```'in progress'```. Запит ```INNER JOIN``` об'єднує три таблиці для отримання імені користувача та назви завдання, що знаходиться у певному статусі:
    ```sql
    SELECT u.fullname, t.title
    FROM users AS u
    INNER JOIN tasks AS t ON u.id = t.user_id
    INNER JOIN status AS s ON t.status_id = s.id
    WHERE s.name = 'in progress';
    ```
    - (**14**) Отримати користувачів та кількість їхніх завдань. Запит ```LEFT JOIN``` гарантує, що всі користувачі будуть включені у результат, навіть якщо у них немає завдань. ```GROUP BY``` групує результати за користувачем, а ```COUNT``` підраховує кількість завдань:
    ```sql
    SELECT u.fullname, COUNT(t.id) AS task_count
    FROM users AS u
    LEFT JOIN tasks AS t ON u.id = t.user_id
    GROUP BY u.fullname
    ORDER BY task_count DESC;
    ```
7. Додаткові налаштування 🛠️

Якщо отримано повідомлення від ```psql``` яке вказує на проблему з кодуванням символів:

```sql
psql (17.5)

WARNING: Console code page (866) differs from Windows code page (1251)

         8-bit characters might not work correctly. See psql reference

         page "Notes for Windows users" for details.

Type "help" for help.
```

**Що означає це попередження**
- **Console code page (866)**: Це кодова сторінка, яка використовується у вашому терміналі (консолі) для відображення тексту. Кодова сторінка 866 (CP866) зазвичай використовується для DOS-консолей і є застарілою.

- **Windows code page (1251)**: Це кодова сторінка, яка використовується операційною системою Windows для відображення кирилиці. Кодова сторінка 1251 (CP1251) є стандартною для більшості програм Windows в регіонах з кирилицею.

- **Warning**: Попередження інформує вас про те, що ці дві кодові сторінки не збігаються, і це може спричинити проблеми з відображенням тексту.

**Як це виправити**

**Спосіб 1: Змінити кодову сторінку консолі**

Ви можете тимчасово змінити кодову сторінку вашої консолі на 1251, щоб вона відповідала кодовій сторінці **Windows**.

- Відкрийте командний рядок (cmd).
- Виконайте команду:

```bash
chcp 1251
```

- Після цього запустіть ```psql``` ще раз.

>[!tip]
>Цей метод діє лише для поточної сесії командного рядка.

**Спосіб 2: Налаштування PowerShell**

Якщо ви використовуєте **PowerShell**, його можна налаштувати так, щоб він використовував **UTF-8**. Це сучасний і універсальний підхід.

- Створіть або відредагуйте профіль **PowerShell**, виконавши команду:

```PowerShell
if (!(Test-Path -Path $PROFILE)) { New-Item -Path $PROFILE -ItemType File -Force }
notepad $PROFILE
```

- Додайте наступні рядки до файлу профілю та збережіть його:

```PowerShell
$OutputEncoding = [System.Text.Encoding]::UTF8
[Console]::OutputEncoding = [System.Text.Encoding]::UTF8
[Console]::InputEncoding = [System.Text.Encoding]::UTF8
```

Перезапустіть **PowerShell**.

**Спосіб 3: Використання клієнта з графічним інтерфейсом**

Використання таких програм, як **DBeaver** або **pgAdmin**, усуває проблеми з кодуванням у консолі, оскільки вони мають власну логіку відображення. Це найпростіший спосіб уникнути подібних попереджень.

[Top :arrow_double_up:](#top)

---

<a id="2"></a>

## Tasck 2

### Mongodb App

1. **Cтворення віртуального оточення**

Це ізолює залежності проєкту від глобального середовища Python.

**Кроки для створення віртуального оточення**

1) Відкрийте термінал або командний рядок. Перейдіть до кореневої папки проєкту ```mongodb_app```.
2) Створіть віртуальне оточення. Використайте модуль ```venv```, <u>який вбудований у Python 3</u>. Назвемо оточення ```venv``` (це поширена практика):

```bash
python -m venv venv
```

Ця команда створить папку ```venv``` у вашій директорії, яка міститиме копію інтерпретатора **Python** та інші необхідні файли.

3) Активуйте віртуальне оточення. Після створення, потрібно його активувати. Команда залежить від операційної системи:

- На **Windows**:

```bash
venv\Scripts\activate
```

- На **macOS** та **Linux**:

```bash
source venv/bin/activate
```

Після активації, перед командним рядком з'явиться назва вашого віртуального оточення ```(venv)```, що вказує на те, що ви працюєте в ізольованому середовищі.

4) Встановіть залежності.
Щоб встановити пакети, використовуйте:

```bash
pip install -r requirements.txt
```

5) Для деактивації віртуального оточення, просто виконайте команду:

```bash
deactivate
```

2. **Налаштуйте MongoDB**

- **Локально з Docker**: Якщо ви використовуєте **Docker**, переконайтеся, що ваш контейнер **MongoDB** запущено. Зазвичай, він доступний за адресою ```mongodb://localhost:27017/```.

- **MongoDB Atlas**: Якщо ви використовуєте **MongoDB Atlas**, вам потрібно буде отримати рядок підключення (connection string) з вашого кластера та замінити значення ```MONGO_URI``` у скрипті. Не забудьте замінити ```<username>```, ```<password>``` та ```<cluster-url>``` на ваші дані.

3. **Запустіть скрипт**

```bash
python main.py
```
Скрипт виконає демонстрацію всіх CRUD операцій, включаючи створення, читання, оновлення та видалення записів про котів. Він також попросить вас ввести деякі дані, щоб продемонструвати інтерактивні функції.

[Top :arrow_double_up:](#top)